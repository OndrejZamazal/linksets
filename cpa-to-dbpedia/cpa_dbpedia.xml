<?xml version="1.0" encoding="utf-8"?>
<Silk>
    <Prefixes>
        <Prefix id="rdfs" namespace="http://www.w3.org/2000/01/rdf-schema#"/>
        <Prefix id="skos" namespace="http://www.w3.org/2004/02/skos/core#"/>
    </Prefixes>
    <DataSources>
        <DataSource id="cpa" type="sparqlEndpoint">
            <Param name="endpointURI" value="http://obeu.vse.cz:8890/sparql"/>
            <Param name="graph" value="http://data.openbudgets.eu/resource/codelist/cpa"/>
        </DataSource>
        <DataSource id="dbpedia" type="sparqlEndpoint">
            <Param name="endpointURI" value="http://internal.opendata.cz:9999/blazegraph/namespace/kb/sparql"/>
            <Param name="pageSize" value="100000"/>
        </DataSource>
    </DataSources>
    <Interlinks>
        <Interlink id="cpa-to-dbpedia">
            <SourceDataset dataSource="cpa" var="a">
                <RestrictTo>?a a skos:Concept .</RestrictTo>
            </SourceDataset>
            <TargetDataset dataSource="dbpedia" var="b"/>
            <LinkageRule linkType="skos:exactMatch">
                <Compare metric="equality" required="true" threshold="0">
                    <TransformInput function="normalizeChars">
                        <TransformInput function="lowerCase">
                            <Input path="?a/skos:prefLabel[@lang = 'en']"/>
                        </TransformInput>
                    </TransformInput>
                    <TransformInput function="normalizeChars">
                        <TransformInput function="lowerCase">
                            <TransformInput function="removeParentheses">
                                <Input path="?b/rdfs:label"/>
                            </TransformInput>
                        </TransformInput>
                    </TransformInput>
                </Compare>
                <Filter limit="1"/>
            </LinkageRule>
            <Outputs>
                <Output type="file">
                    <Param name="file" value="cpa_dbpedia.nt"/>
                    <Param name="format" value="ntriples"/>
                </Output>
            </Outputs>
        </Interlink>
    </Interlinks>
</Silk>
